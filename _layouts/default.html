<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ page.title }} | {{ site.title }}</title>
    <meta name="description" content="{{ page.description | default: site.description }}">
    <meta name="color-scheme" content="light"><!-- Mermaid等の自動ダーク回避 -->

    <!-- 基本スタイル（キャッシュバスター付き） -->
    <link rel="stylesheet" href="{{ '/assets/style.css' | relative_url }}?v={{ site.time | date: '%s' }}" />
  </head>

  <!-- ★ ポータル全体を Sepia テーマに固定 -->
  <body class="theme-sepia">
    <main>
      {{ content }}
    </main>

    <!-- Mermaid JS（CDN） -->
    <script defer src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>

    <!-- Mermaid 初期化：code→div 置換 ＋ ライト固定 ＋ 中央寄せ -->
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        // 1) ```mermaid → <div class="mermaid"> に変換
        document.querySelectorAll('code.language-mermaid').forEach(function (code) {
          const pre = code.closest('pre');
          const div = document.createElement('div');
          div.className = 'mermaid';
          div.textContent = code.textContent;
          if (pre) pre.replaceWith(div); else code.replaceWith(div);
        });

        // 2) 中央寄せ
        document.querySelectorAll('.mermaid').forEach(function (el) {
          el.style.display = 'block';
          el.style.margin = '1.5rem auto';
          el.style.maxWidth = '960px';
          el.style.textAlign = 'center';
        });

        // 3) Mermaid をライトテーマで固定
        if (window.mermaid) {
          mermaid.initialize({
            startOnLoad: true,
            securityLevel: 'loose',
            theme: 'default'
          });
        }
      });
    </script>
  </body>
</html>
